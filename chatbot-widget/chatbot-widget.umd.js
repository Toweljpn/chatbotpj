(function(e,d){typeof exports=="object"&&typeof module<"u"?module.exports=d(require("vue")):typeof define=="function"&&define.amd?define(["vue"],d):(e=typeof globalThis<"u"?globalThis:e||self,e.ChatbotWidget=d(e.Vue))})(this,function(e){"use strict";const d=(u,r)=>{const a=u.__vccOpts||u;for(const[i,o]of r)a[i]=o;return a},b={class:"message-list"},W={key:0,class:"loading-message"},C={class:"input-area"},N=["disabled"],D=["disabled"],V="https://black-mud-382d.corsicajp.workers.dev/",B=d({__name:"ChatbotWindow",setup(u){const r=e.ref([]),a=e.ref(""),i=e.ref(!1),o=e.ref(null),p=e.ref(!1),f=e.ref(0),w=e.ref(0),m=e.ref(0),h=e.ref(0),I=s=>{p.value=!0,f.value=s.clientX,w.value=s.clientY;const t=window.getComputedStyle(o.value);m.value=parseFloat(t.left),h.value=parseFloat(t.top),window.addEventListener("mousemove",y),window.addEventListener("mouseup",g)},y=s=>{if(!p.value)return;const t=s.clientX-f.value,l=s.clientY-w.value;let n=m.value+t,c=h.value+l;const _=o.value.offsetWidth,E=o.value.offsetHeight,k=window.innerWidth,x=window.innerHeight;n<0&&(n=0),c<0&&(c=0),n+_>k&&(n=k-_),c+E>x&&(c=x-E),o.value.style.left=`${n}px`,o.value.style.top=`${c}px`,console.log(`Dragging: newX=${n}, newY=${c}, style.left=${o.value.style.left}, style.top=${o.value.style.top}`)},g=()=>{p.value=!1,window.removeEventListener("mousemove",y),window.removeEventListener("mouseup",g)},v=async()=>{if(a.value.trim()==="")return;const s=a.value;r.value.push({type:"user",text:s}),a.value="",i.value=!0;try{const t=await fetch(V,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({question:s})});if(!t.ok){const n=await t.json();throw new Error(`API Error: ${t.status} - ${n.error||"Unknown error"}`)}const l=await t.json();r.value.push({type:"ai",text:l.answer})}catch(t){console.error("Failed to fetch AI answer:",t),r.value.push({type:"ai",text:"エラーが発生しました: "+t.message})}finally{i.value=!1}};return e.onMounted(()=>{o.value&&(console.log("Chat window element:",o.value),o.value.style.left="50px",o.value.style.top="50px")}),(s,t)=>(e.openBlock(),e.createElementBlock("div",{class:"chat-container",ref_key:"chatWindow",ref:o},[e.createElementVNode("div",{class:"chat-header",onMousedown:I},t[1]||(t[1]=[e.createElementVNode("h1",null,"AI Chatbot",-1)]),32),e.createElementVNode("div",b,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(r.value,(l,n)=>(e.openBlock(),e.createElementBlock("div",{key:n,class:e.normalizeClass(["message",l.type])},e.toDisplayString(l.text),3))),128)),i.value?(e.openBlock(),e.createElementBlock("div",W,"AIが思考中...")):e.createCommentVNode("",!0)]),e.createElementVNode("div",C,[e.withDirectives(e.createElementVNode("input",{"onUpdate:modelValue":t[0]||(t[0]=l=>a.value=l),onKeyup:e.withKeys(v,["enter"]),placeholder:"質問を入力してください...",disabled:i.value},null,40,N),[[e.vModelText,a.value]]),e.createElementVNode("button",{onClick:v,disabled:i.value},"送信",8,D)])],512))}},[["__scopeId","data-v-fda0551a"]]);return e.defineComponent(B)});
