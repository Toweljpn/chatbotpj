(function(e,c){typeof exports=="object"&&typeof module<"u"?module.exports=c(require("vue")):typeof define=="function"&&define.amd?define(["vue"],c):(e=typeof globalThis<"u"?globalThis:e||self,e.ChatbotWidget=c(e.Vue))})(this,function(e){"use strict";const c=(u,r)=>{const a=u.__vccOpts||u;for(const[l,o]of r)a[l]=o;return a},x={class:"message-list"},W={key:0,class:"loading-message"},C={class:"input-area"},N=["disabled"],V=["disabled"],B="https://black-mud-382d.corsicajp.workers.dev/",D=c({__name:"ChatbotWindow",setup(u){const r=e.ref([]),a=e.ref(""),l=e.ref(!1),o=e.ref(null),p=e.ref(!1),f=e.ref(0),w=e.ref(0),m=e.ref(0),h=e.ref(0),I=n=>{p.value=!0,f.value=n.clientX,w.value=n.clientY;const t=window.getComputedStyle(o.value);m.value=parseFloat(t.left),h.value=parseFloat(t.top),window.addEventListener("mousemove",y),window.addEventListener("mouseup",v)},y=n=>{if(!p.value)return;const t=n.clientX-f.value,i=n.clientY-w.value;let s=m.value+t,d=h.value+i;const _=o.value.offsetWidth,E=o.value.offsetHeight,k=window.innerWidth,b=window.innerHeight;s<0&&(s=0),d<0&&(d=0),s+_>k&&(s=k-_),d+E>b&&(d=b-E),o.value.style.left=`${s}px`,o.value.style.top=`${d}px`},v=()=>{p.value=!1,window.removeEventListener("mousemove",y),window.removeEventListener("mouseup",v)},g=async()=>{if(a.value.trim()==="")return;const n=a.value;r.value.push({type:"user",text:n}),a.value="",l.value=!0;try{const t=await fetch(B,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({question:n})});if(!t.ok){const s=await t.json();throw new Error(`API Error: ${t.status} - ${s.error||"Unknown error"}`)}const i=await t.json();r.value.push({type:"ai",text:i.answer})}catch(t){console.error("Failed to fetch AI answer:",t),r.value.push({type:"ai",text:"エラーが発生しました: "+t.message})}finally{l.value=!1}};return e.onMounted(()=>{o.value&&(o.value.style.left="50px",o.value.style.top="50px")}),(n,t)=>(e.openBlock(),e.createElementBlock("div",{class:"chat-container",ref_key:"chatWindow",ref:o},[e.createElementVNode("div",{class:"chat-header",onMousedown:I},t[1]||(t[1]=[e.createElementVNode("h1",null,"AI Chatbot",-1)]),32),e.createElementVNode("div",x,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(r.value,(i,s)=>(e.openBlock(),e.createElementBlock("div",{key:s,class:e.normalizeClass(["message",i.type])},e.toDisplayString(i.text),3))),128)),l.value?(e.openBlock(),e.createElementBlock("div",W,"AIが思考中...")):e.createCommentVNode("",!0)]),e.createElementVNode("div",C,[e.withDirectives(e.createElementVNode("input",{"onUpdate:modelValue":t[0]||(t[0]=i=>a.value=i),onKeyup:e.withKeys(g,["enter"]),placeholder:"質問を入力してください...",disabled:l.value},null,40,N),[[e.vModelText,a.value]]),e.createElementVNode("button",{onClick:g,disabled:l.value},"送信",8,V)])],512))}},[["__scopeId","data-v-aabab572"]]);return e.defineComponent(D)});
